<html>
<body>
<div>
<h2>Carrier On-Time Performance for Airports</h2></div>
<select onchange="window.location.href='AirportCarrierStats.html?airport=' + this.value" name="airport">
  <option id="ORD" value="ORD">Chicago O'Hare</option>
  <option id="SFO" value="SFO">San Francisco International</option>
</select>
<div id="chartContainer">
  <script src="/lib/d3.v3.4.12.min.js"></script>
  <script src="/lib/dimple.v2.1.6.min.js"></script>
  <script type="text/javascript">

  const selectedAirport = getQueryVariable('airport');
  document.getElementById(selectedAirport).selected=true;

  function getMonthFromArgs() {

  }

  function getQueryVariable(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split('&');
      for (var i = 0; i < vars.length; i++) {
          var pair = vars[i].split('=');
          if (decodeURIComponent(pair[0]) == variable) {
              return decodeURIComponent(pair[1]);
          }
      }
      console.log('Query variable %s not found', variable);
  }

    function getAirportFromArgs() {
      var returnAirport = "";
      var args = window.location.search.substring(1);
      if (args.indexOf("&") > 0) {
        nameValuePairs = args.split("&");
        returnAirport=args[1];

      } else {
        throw "Multiple request parameters not accepted. Please specify an airport parameter."
      }
      console.log("Airport = " + returnAirport);
    }
    var airport = window.location.search.substring(1)

    var svg = dimple.newSvg("#chartContainer", 590, 400);
    d3.csv("/data/airport_carrier_stats.csv", function (data) {
      data2 = data.filter(function(row) {
        return row['Origin'] === "ORD";
      })
      console.log("Data rows = " + data.length);
      console.log("Filtered rows = " + data2.length);
      // console.log("Airport argument is: " + get('airport'));
      console.log(window.location.search);
//      debugger;
      var myChart = new dimple.chart(svg, data2);
      myChart.setBounds(60, 45, 510, 315);
      myChart.addCategoryAxis("x", "CarrierName");
      myChart.addMeasureAxis("y", "Count");
      myChart.addSeries("RecordType", dimple.plot.bar);
      myChart.addLegend(200, 10, 380, 20, "right");
      myChart.draw();
    });
  </script>
</div>
</body>

</html>